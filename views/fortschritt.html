<section class="rehaprogress">
  <div class="rp-head">
    <a class="rp-doc btn-dark" href="assets/nachbehandlung.pdf" download>
      ðŸ“„ Nachbehandlungs-Dokument
    </a>

    <!-- KPI rechts -->
    <aside class="card-dark rp-kpi" aria-label="KPI-Fortschritt">
      <h3>KPI â€“ Fortschritt</h3>

      <div class="kpi-row">
        <div class="kpi-label">Beweglichkeit â€“ <b id="kpi-mobility-val">75%</b></div>
        <div class="kpi-bar"><span id="kpi-mobility-bar" style="width:75%"></span></div>
      </div>

      <div class="kpi-donuts">
        <figure class="donut">
          <svg viewBox="0 0 120 120" class="donut-svg" aria-label="Kraft 25 Prozent">
            <circle class="donut-bg" cx="60" cy="60" r="48"></circle>
            <circle id="donut-strength" class="donut-val" cx="60" cy="60" r="48"></circle>
          </svg>
          <figcaption>Kraft â€“ <b id="kpi-strength-val">25%</b></figcaption>
        </figure>

        <figure class="donut">
          <svg viewBox="0 0 120 120" class="donut-svg" aria-label="Ausdauer 62 Prozent">
            <circle class="donut-bg" cx="60" cy="60" r="48"></circle>
            <circle id="donut-endurance" class="donut-val" cx="60" cy="60" r="48"></circle>
          </svg>
          <figcaption>Ausdauer â€“ <b id="kpi-endurance-val">62%</b></figcaption>
        </figure>
      </div>

      <div class="kpi-row">
        <div class="kpi-label">Schmerzreduktion â€“ <b id="kpi-pain-val">85%</b></div>
        <div class="kpi-bar"><span id="kpi-pain-bar" style="width:85%"></span></div>
      </div>
    </aside>
  </div>

  <!-- Zahlenstrahl -->
  <article class="card rp-timeline">
    <div class="slots" id="tl-slots">
      <div class="slot">1. TAG</div>
      <div class="slot">2. TAG</div>
      <div class="slot">AB 7. TAG</div>
      <div class="slot">AB 2. WOCHE</div>
      <div class="slot">AB 4. WOCHE</div>
      <div class="slot">AB 6â€“8. WOCHE</div>
      <div class="slot">AB 20. WOCHE</div>
    </div>

    <div class="phase-row">
      <span class="phase-chip">Aktuelle Phase</span>
      <div class="track">
        <span id="track-progress"></span>
        <div class="marks" id="tl-marks"></div>
      </div>
    </div>
  </article>

  <!-- Info-Kacheln -->
  <div class="rp-info">
    <article class="card pill">
      <h4>BEWEGUNGSUMFANG</h4>
      <ul class="list">
        <li>Abtrainieren der Hartrahmenorthese bei normalem Gangbild</li>
      </ul>
    </article>

    <article class="card pill">
      <h4>BELASTUNG</h4>
      <ul class="list">
        <li>Volles KÃ¶rpergewicht (ohne Gehhilfen)</li>
      </ul>
    </article>

    <article class="card pill">
      <h4>BEHANDLUNG</h4>
      <ul class="list">
        <li>Passive BewegungsÃ¼bung</li>
        <li>Gangschule (Treppen)</li>
        <li>Lymphdrainage</li>
      </ul>
    </article>
  </div>
</section>

<style>
:root{
  --bg:#f3f5f8; --card:#fff; --line:#e6eaf1;
  --ink:#0f213d; --muted:#6a778e;
  --primary:#142b52; --accent:#6fa8ff; --accent2:#2f6dff;
  --radius:18px; --shadow:0 10px 28px rgba(15,33,61,.08);
}

.rehaprogress{padding:18px 0;color:var(--ink)}
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
.card-dark{background:#162d54;color:#fff;border-radius:24px;padding:18px;box-shadow:var(--shadow)}
.btn-dark{display:inline-flex;align-items:center;gap:.6rem;background:#162d54;color:#fff;
  padding:12px 16px;border-radius:14px;font-weight:800;text-decoration:none;box-shadow:var(--shadow)}
.btn-dark:hover{filter:brightness(1.06)}

.rp-head{display:grid;grid-template-columns:1fr 380px;gap:18px;align-items:start;margin-bottom:16px}
@media (max-width:900px){.rp-head{grid-template-columns:1fr}}

.rp-kpi h3{margin:0 0 12px}
.kpi-row{margin:10px 0 16px}
.kpi-label{font-weight:800}
.kpi-bar{height:10px;background:rgba(255,255,255,.18);border-radius:999px;overflow:hidden;margin-top:6px}
.kpi-bar span{display:block;height:100%;background:var(--accent);border-radius:999px;transition:width .35s}
.kpi-donuts{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin:6px 0 8px}
.donut{display:grid;place-items:center;gap:8px}
.donut-svg{width:140px;height:140px}
.donut-bg{fill:none;stroke:rgba(255,255,255,.16);stroke-width:12}
.donut-val{fill:none;stroke:var(--accent);stroke-width:12;transform:rotate(-90deg);transform-origin:50% 50%;
  stroke-linecap:round;stroke-dasharray:301.59;stroke-dashoffset:301.59;transition:stroke-dashoffset .6s ease}
.donut figcaption{text-align:center;font-size:.92rem}

.rp-timeline{padding:14px}
.rp-timeline .slots{
  display:grid;
  grid-template-columns:repeat(7,minmax(110px,1fr));
  gap:8px;
}
.rp-timeline .slot{
  background:#fff;border:1px solid var(--line);border-radius:12px;
  padding:10px 8px;text-align:center;font-size:.82rem;color:#4d5a73;white-space:nowrap;
}
.rp-timeline .slot.current{background:#e6edf9;border-color:#cfe0ff;font-weight:900;color:#0f213d}

.rp-timeline .phase-row{margin-top:10px}
.phase-chip{display:inline-block;background:#0f213d;color:#fff;padding:4px 10px;border-radius:10px;font-weight:900;font-size:.86rem}

.rp-timeline .track{
  position:relative;height:14px;background:#273b59;border-radius:999px;margin-top:8px;overflow:visible;
}
.rp-timeline #track-progress{
  position:absolute;left:0;top:0;bottom:0;background:var(--accent2);
  border-radius:999px;width:0;transition:width .3s ease;
}
.rp-timeline .marks{position:absolute;inset:-8px 0 0 0;pointer-events:none;}
.rp-timeline .marks .m{
  position:absolute;top:-2px;width:18px;height:18px;border-radius:999px;
  background:#79d5ff;border:3px solid #d2f0ff;transform:translateX(-50%);
}

.rp-info{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:16px}
.pill{padding:14px;border-radius:28px}
.pill h4{margin:0 0 8px;letter-spacing:.8px}
.list{margin:0;padding-left:18px}
.list li{margin:6px 0}
@media (max-width:900px){.rp-info{grid-template-columns:1fr}}
</style>

<script>
(() => {
  const currentIndex = 4; // 0..6 â†’ "AB 4. WOCHE"
  const kpis = { mobility:75, strength:25, endurance:62, pain:85 };

  // Timeline
  const slotsWrap = document.getElementById('tl-slots');
  const slots = [...slotsWrap.querySelectorAll('.slot')];
  slots.forEach((el,i)=> el.classList.toggle('current', i===currentIndex));
  const progress = document.getElementById('track-progress');
  const marks = document.getElementById('tl-marks');

  function updateMarksAndProgress(){
    const wrapRect = slotsWrap.getBoundingClientRect();
    marks.innerHTML='';
    slots.forEach((slot,i)=>{
      const r = slot.getBoundingClientRect();
      const center=((r.left+r.right)/2)-wrapRect.left;
      const m=document.createElement('i');
      m.className='m';
      m.style.left=(center/wrapRect.width*100)+'%';
      marks.appendChild(m);
    });
    const slotRect=slots[currentIndex].getBoundingClientRect();
    const right=slotRect.right-wrapRect.left;
    const pct=(right/wrapRect.width)*100;
    progress.style.width=pct+'%';
  }

  updateMarksAndProgress();
  window.addEventListener('resize',updateMarksAndProgress);

  // KPI-Werte
  document.getElementById('kpi-mobility-val').textContent = kpis.mobility + '%';
  document.getElementById('kpi-mobility-bar').style.width = kpis.mobility + '%';
  document.getElementById('kpi-pain-val').textContent = kpis.pain + '%';
  document.getElementById('kpi-pain-bar').style.width = kpis.pain + '%';

  // Donut-Animation
  const CIRC=2*Math.PI*48;
  const setDonut=(id,val,outId)=>{
    const c=document.getElementById(id);
    if(!c)return;
    const off=CIRC*(1-val/100);
    c.style.strokeDashoffset=off;
    if(outId)document.getElementById(outId).textContent=val+'%';
  };
  setDonut('donut-strength',kpis.strength,'kpi-strength-val');
  setDonut('donut-endurance',kpis.endurance,'kpi-endurance-val');
})();
</script>
